<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Анімація з Dragon Bones - Основи Cocos2d-x</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Анімація з Dragon Bones" />
<meta property="og:description" content="Існує багато різних засобів для створення скелетної анімації, але більшість з них платні, а тому недоступні для вивчення. У цій статті мова піде про Dragon Bones — доступний, але трохи своєрідний варіант.
Основною перевагою Dragon Bones є те, що ця програма має достатню функціональність і при цьому є безкоштовною. Точніше, редактор є безкоштовним з закритим кодом, а код для інтеграції з Cocos2d розповсюджується за ліцензією MIT." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://beardog-ukr.github.io/cocos2dx-examples/uk/post/dragonbones-animation/" />
<meta property="article:published_time" content="2020-04-15T17:30:25+03:00" />
<meta property="article:modified_time" content="2020-04-15T17:30:25+03:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Анімація з Dragon Bones"/>
<meta name="twitter:description" content="Існує багато різних засобів для створення скелетної анімації, але більшість з них платні, а тому недоступні для вивчення. У цій статті мова піде про Dragon Bones — доступний, але трохи своєрідний варіант.
Основною перевагою Dragon Bones є те, що ця програма має достатню функціональність і при цьому є безкоштовною. Точніше, редактор є безкоштовним з закритим кодом, а код для інтеграції з Cocos2d розповсюджується за ліцензією MIT."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://beardog-ukr.github.io/cocos2dx-examples/uk/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://beardog-ukr.github.io/cocos2dx-examples/uk/css/main.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<script src="https://beardog-ukr.github.io/cocos2dx-examples/uk/js/main.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title"><a href="https://beardog-ukr.github.io/cocos2dx-examples/uk/">Основи Cocos2d-x</a></h1>
	<div class="site-description"><h2>Статті про розробку ігор за допомогою Cocos2d-x</h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/beardog-ukr/cocos2dx-examples" title="Github"><i data-feather="github"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/cocos2dx-examples/uk/">Нове</a>
			</li>
			
			<li>
				<a href="/cocos2dx-examples/uk/posts">Усі пости</a>
			</li>
			
			<li>
				<a href="/cocos2dx-examples/uk/about">Про сайт</a>
			</li>
			
			<li>
				<a href="/cocos2dx-examples/uk/tags">Теги</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">Анімація з Dragon Bones</h1>
			<div class="meta">Posted at &mdash; Apr 15, 2020</div>
		</div>

		<div class="markdown">
			<p>Існує <a href="https://www.slant.co/options/15725/alternatives/~dragonbones-pro-alternatives">багато</a> різних засобів для створення скелетної анімації, але більшість з них платні, а тому недоступні для вивчення. У цій статті мова піде про <a href="https://dragonbones.github.io/en/index.html">Dragon Bones</a> — доступний, але трохи своєрідний варіант.</p>
<p>Основною перевагою <em>Dragon Bones</em> є те, що ця програма має достатню функціональність і при цьому є безкоштовною. Точніше, редактор є безкоштовним з закритим кодом, а код для інтеграції з <em>Cocos2d</em> розповсюджується за ліцензією MIT.</p>
<p>Основний недолік — китайське походження, і в даному випадку це не просто географічна характеристика. Скажімо, прямо зараз вам наврядчи вдастся скачати редактор з офіційної <a href="https://dragonbones.github.io/en/download.html">сторінки завантаження</a>, там виникли якісь проблеми з нововведеннями у сучасних браузерах. Код інтеграції, що знаходиться в <a href="https://github.com/DragonBones/DragonBonesCPP/tree/master/Cocos2DX_3.x">офіційному репозиторії</a>, вже трохи застарів, тому я б радив брати за основу для своєї розробки <a href="https://github.com/beardog-ukr/dragonbones-cocos2dx-v4-demo">ось цей</a> репозиторій, там внесені усі зміни, необхідні для Cocos2d V4.</p>
<p>Хай там як, після подолання початкових проблем <em>Dragon Bones</em> працює стабільно і з ним можна робити досить круті штуки. Наприклад, такі:
<figure>
    <img src="/cocos2dx-examples/uk/post/dragon-bones-img/dragon_bones_mecha.gif"/> <figcaption>
            <h4>Приклад CoreElementGame з офіційного репозиторію</h4>
        </figcaption>
</figure>
</p>
<p>Ясно, що це просто малюнок, <a href="https://github.com/beardog-ukr/dragonbones-cocos2dx-v4-demo/blob/master/DemoProj/Resources/mecha_1502b/mecha_1502b_tex.png">тут</a> цього робота можна побачити розібраним на запчастини.</p>
<p>Для прикладу у цій статті ми візьмемо персонажів з <a href="https://jordan97.itch.io/cartoon-character-kit">безкоштовного набору</a> і дамо їм в руки <a href="https://krukowski.itch.io/free-weapons">мечі</a> та <a href="https://kaylousberg.itch.io/gun-assets">вогнепальну зброю</a>.</p>
<p>Процес створення моделі та анімації я не буду описувати, тому що це скоріше справа художників, там є окремі нюанси. Можна порадити такі навчальні матеріали: <a href="http://getting-started-dragonbones.blogspot.com/2017/01/dragonbones-tutorial-part-i.html">перший</a>, <a href="https://habr.com/ru/post/350254/">другий</a>, <a href="https://topic.alibabacloud.com/a/a-tutorial-on-using-the-dragonbones-of-the-skeleton-animation-tool_8_8_31057239.html">третій</a>. Натомість краще сфокусуватись на особливостях, важливих для програмування.</p>
<p>Результатом експорту з <em>Dragon Bones</em> до <em>Cocos2d</em> є <a href="https://github.com/beardog-ukr/cocos2dx-examples/tree/master/examples/DragonBonesImport/Resources/db_export">три файли</a>: два json, що описують модель, та одне зображення-ресурс.</p>
<p>Імпорт моделі до програми виглядає схожим на завантаження plist-файлів:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#719e07">#include</span> <span style="color:#719e07">&#34;dragonBones/cocos2dx/CCDragonBonesHeaders.h&#34;</span><span style="color:#719e07">
</span><span style="color:#719e07"></span>
dragonBones<span style="color:#719e07">::</span>CCFactory<span style="color:#719e07">*</span> factory <span style="color:#719e07">=</span> dragonBones<span style="color:#719e07">::</span>CCFactory<span style="color:#719e07">::</span>getFactory();
factory<span style="color:#719e07">-&gt;</span>loadDragonBonesData(<span style="color:#2aa198">&#34;db_export/BlueWizard_ske.json&#34;</span>, <span style="color:#2aa198">&#34;BlueWizard&#34;</span>);
factory<span style="color:#719e07">-&gt;</span>loadTextureAtlasData(<span style="color:#2aa198">&#34;db_export/BlueWizard_tex.json&#34;</span>, <span style="color:#2aa198">&#34;BlueWizard&#34;</span>);

dragonBones<span style="color:#719e07">::</span>CCArmatureDisplay<span style="color:#719e07">*</span> wizard <span style="color:#719e07">=</span> factory<span style="color:#719e07">-&gt;</span>buildArmatureDisplay(<span style="color:#2aa198">&#34;WizardArmature&#34;</span>, <span style="color:#2aa198">&#34;BlueWizard&#34;</span>);

wizard<span style="color:#719e07">-&gt;</span>setAnchorPoint(Vec2(<span style="color:#2aa198">0.5</span>,<span style="color:#2aa198">0.5</span>));
wizard<span style="color:#719e07">-&gt;</span>setScale(<span style="color:#2aa198">0.33</span>);
wizard<span style="color:#719e07">-&gt;</span>setPosition(<span style="color:#2aa198">160</span>,<span style="color:#2aa198">140</span>);
addChild(wizard, <span style="color:#2aa198">10</span>);
</code></pre></div><p><a href="https://github.com/beardog-ukr/dragonbones-cocos2dx-v4-demo/blob/master/DemoProj/Classes/dragonBones/cocos2dx/CCArmatureDisplay.h">CCArmatureDisplay</a> — клас для об'єктів, з якими ви працюєте на сцені. Він є нащадком <em>Node</em>, тому з ним можна робити всі тіж самі речі, що й з іншими об'єктами <em>Cocos2d</em>.</p>
<p>&ldquo;BlueWizard&rdquo; — це щось типу тегу, який відрізняє дану завантажену модель від усіх інших. У документації цей параметр згадується як <em>displayName</em>.</p>
<p>&ldquo;WizardArmature&rdquo; — назва скелету (<em>armatureName</em>), яка вказується у редакторі, ось тут:</p>
<figure>
    <img src="/cocos2dx-examples/uk/post/dragon-bones-img/db_screen_01a.png"/> 
</figure>

<p>Програвання анімації викликається ось так:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">wizard<span style="color:#719e07">-&gt;</span>getAnimation()<span style="color:#719e07">-&gt;</span>play(<span style="color:#2aa198">&#34;idle01&#34;</span>, <span style="color:#2aa198">1</span>);<span style="color:#586e75">//1 to play animation once
</span></code></pre></div><p>Виглядатиме це так:
<figure>
    <img src="/cocos2dx-examples/uk/post/dragon-bones-img/wizard_move.gif"/> 
</figure>
</p>
<p>Частини скелету можна змінювати прямо під час виконання програми, досягти цього можна двома способами.</p>
<p>По-перше, редактор дозволяє в одному слоті зберегти кілька варіантів зображень. Наприкад, тут у слоті &ldquo;Gun&rdquo; їх три:
<figure>
    <img src="/cocos2dx-examples/uk/post/dragon-bones-img/db_screen_02.png"/> 
</figure>
</p>
<p>В такому випадку перемикання з одного зображення на інше виконується простим вказуванням індексу:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#dc322f">int</span> currentWeaponIndex;
<span style="color:#719e07">&lt;</span>....<span style="color:#719e07">&gt;</span>
wizard<span style="color:#719e07">-&gt;</span>getArmature()<span style="color:#719e07">-&gt;</span>getSlot(<span style="color:#2aa198">&#34;Gun&#34;</span>)<span style="color:#719e07">-&gt;</span>setDisplayIndex(currentWeaponIndex);
</code></pre></div><p>По-друге, можна створити <a href="https://github.com/beardog-ukr/cocos2dx-examples/tree/master/examples/DragonBonesProjects/WeaponPack">окрему модель</a>, у якій будуть лише змінювані зображення. Тоді завантаження і використання виглядатиме складніше:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">dragonBones<span style="color:#719e07">::</span>CCFactory<span style="color:#719e07">*</span> factory <span style="color:#719e07">=</span> dragonBones<span style="color:#719e07">::</span>CCFactory<span style="color:#719e07">::</span>getFactory();
factory<span style="color:#719e07">-&gt;</span>loadDragonBonesData(<span style="color:#2aa198">&#34;db_export/MagentaKnight_ske.json&#34;</span>, <span style="color:#2aa198">&#34;MagentaKnight&#34;</span>);
factory<span style="color:#719e07">-&gt;</span>loadTextureAtlasData(<span style="color:#2aa198">&#34;db_export/MagentaKnight_tex.json&#34;</span>, <span style="color:#2aa198">&#34;MagentaKnight&#34;</span>);

factory<span style="color:#719e07">-&gt;</span>loadDragonBonesData(<span style="color:#2aa198">&#34;db_export/WeaponPack_ske.json&#34;</span>, <span style="color:#2aa198">&#34;WeaponPackMK&#34;</span>);
factory<span style="color:#719e07">-&gt;</span>loadTextureAtlasData(<span style="color:#2aa198">&#34;db_export/WeaponPack_tex.json&#34;</span>, <span style="color:#2aa198">&#34;WeaponPackMK&#34;</span>);

knight <span style="color:#719e07">=</span> factory<span style="color:#719e07">-&gt;</span>buildArmatureDisplay(<span style="color:#2aa198">&#34;KnightArmature&#34;</span>, <span style="color:#2aa198">&#34;MagentaKnight&#34;</span>);

<span style="color:#719e07">&lt;</span>..пізніше..<span style="color:#719e07">&gt;</span>
factory<span style="color:#719e07">-&gt;</span>replaceSlotDisplay(<span style="color:#2aa198">&#34;WeaponPackMK&#34;</span>, <span style="color:#2aa198">&#34;WeaponPackArmature&#34;</span>, <span style="color:#2aa198">&#34;OneHandWeaponSlot&#34;</span>,
                            <span style="color:#2aa198">&#34;morning_star&#34;</span>, knight<span style="color:#719e07">-&gt;</span>getArmature()<span style="color:#719e07">-&gt;</span>getSlot(<span style="color:#2aa198">&#34;Weapon&#34;</span>));
</code></pre></div><p>Тут &ldquo;WeaponPackArmature&rdquo; та &ldquo;OneHandWeaponSlot&rdquo; — ідентифікатори скелету та слоту, вказані у редакторі:
<figure>
    <img src="/cocos2dx-examples/uk/post/dragon-bones-img/db_screen_03.png"/> 
</figure>
</p>
<p>В обох випадках результат виглядатиме однаково:
<figure>
    <img src="/cocos2dx-examples/uk/post/dragon-bones-img/weapon_change.gif"/> 
</figure>
</p>
		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/cocos2dx-examples/uk/tags/animation">Animation</a></li>
								
								<li><a href="/cocos2dx-examples/uk/tags/dragon-bones">Dragon Bones</a></li>
								
								<li><a href="/cocos2dx-examples/uk/tags/third-party-tools">third-party tools</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © суспільне надбання |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-179222596-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>feather.replace()</script>
</body>
</html>
